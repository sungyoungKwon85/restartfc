<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>아마추어 팀 자동 라인업</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 12px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      font-size: 20px;
      margin-bottom: 8px;
    }
    h2 {
      font-size: 18px;
      margin-top: 20px;
      margin-bottom: 6px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      align-items: center;
      margin-bottom: 16px;
      padding: 8px;
      border-radius: 8px;
      background: #f5f5f5;
    }
    label {
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    select, input[type="number"], input[type="text"] {
      font-size: 12px;
    }
    button {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      background: #2b7cff;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    button:active {
      transform: scale(0.98);
    }
    .btn-secondary {
      background: #6b7280;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 4px 6px;
      text-align: center;
    }
    th {
      background: #fafafa;
    }
    .players-table {
      max-height: 260px;
      overflow: auto;
      border: 1px solid #ddd;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    .q-wrapper {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }
    .q-card {
      border-radius: 8px;
      padding: 6px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .q-card h3 {
      font-size: 14px;
      margin: 0 0 4px;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 10px;
      background: #e5e7eb;
      margin-left: 4px;
    }
    .note {
      font-size: 11px;
      color: #666;
      margin-top: 4px;
    }
    .text-right {
      text-align: right;
    }
    .icon-btn {
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 2px 4px;
      font-size: 12px;
      color: #9ca3af;
    }
    .icon-btn:hover {
      color: #ef4444;
    }

    /* 포메이션 그라운드 뷰 */
    .pitch {
      margin-top: 6px;
      padding: 4px;
      border-radius: 8px;
      background: #020617;
      background-image: linear-gradient(to bottom, rgba(148,163,184,0.15) 1px, transparent 1px),
                        linear-gradient(to right, rgba(148,163,184,0.15) 1px, transparent 1px);
      background-size: 18px 18px;
      color: #e5e7eb;
      font-size: 10px;
    }
    .pitch-row {
      display: flex;
      justify-content: center;
      margin: 2px 0;
    }
    .pitch-cell {
      min-width: 46px;
      min-height: 22px;
      border-radius: 4px;
      border: 1px solid rgba(148,163,184,0.6);
      margin: 0 2px;
      padding: 2px 4px;
      text-align: center;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .pitch-pos {
      opacity: 0.7;
      font-size: 9px;
      line-height: 1.1;
    }
    .pitch-name {
      font-size: 10px;
      font-weight: 600;
      line-height: 1.1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 600px) {
      body { padding: 8px; }
      .controls { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <h1>아마추어 팀 자동 라인업</h1>

  <!-- 상단 설정 영역 -->
  <div class="controls">
    <label>
      출전 인원 (한 팀)
      <select id="playersPerSide">
        <option value="10">10 : 10</option>
        <option value="11" selected>11 : 11</option>
      </select>
    </label>

    <label>
      1쿼 포메이션
      <select id="fQ1">
        <option value="4-back" selected>4-back (10명=4-2-3, 11명=4-3-3)</option>
        <option value="3-back">3-back (10명=3-5-1, 11명=3-4-3)</option>
      </select>
    </label>
    <label>
      2쿼 포메이션
      <select id="fQ2">
        <option value="4-back" selected>4-back (10명=4-2-3, 11명=4-3-3)</option>
        <option value="3-back">3-back (10명=3-5-1, 11명=3-4-3)</option>
      </select>
    </label>
    <label>
      3쿼 포메이션
      <select id="fQ3">
        <option value="4-back">4-back (10명=4-2-3, 11명=4-3-3)</option>
        <option value="3-back" selected>3-back (10명=3-5-1, 11명=3-4-3)</option>
      </select>
    </label>
    <label>
      4쿼 포메이션
      <select id="fQ4">
        <option value="4-back">4-back (10명=4-2-3, 11명=4-3-3)</option>
        <option value="3-back" selected>3-back (10명=3-5-1, 11명=3-4-3)</option>
      </select>
    </label>

    <button onclick="generateLineup()">라인업 생성</button>
  </div>

  <!-- 포지션 자동완성용 datalist -->
  <datalist id="positionList">
    <option value="GK"></option>
    <option value="LB"></option>
    <option value="LCB"></option>
    <option value="CB"></option>
    <option value="RCB"></option>
    <option value="RB"></option>
    <option value="DM"></option>
    <option value="CM"></option>
    <option value="LCM"></option>
    <option value="RCM"></option>
    <option value="LM"></option>
    <option value="RM"></option>
    <option value="AM"></option>
    <option value="LW"></option>
    <option value="RW"></option>
    <option value="CF"></option>
  </datalist>

  <!-- 선수 설정 표 -->
  <h2>선수 / 출전 설정</h2>
  <div class="players-table">
    <table id="playersTable">
      <thead>
        <tr>
          <th>참석</th>
          <th>이름</th>
          <th>주포지션</th>
          <th>서브1</th>
          <th>서브2</th>
          <th>목표 쿼터</th>
          <th>시작Q</th>
          <th>종료Q</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      <!-- JS에서 채움 -->
      </tbody>
    </table>
  </div>
  <div class="text-right" style="margin-bottom:4px;">
    <button class="btn-secondary" onclick="addPlayer()">선수 추가</button>
    <button class="btn-secondary" onclick="resetPlayers()">선수 초기화</button>
  </div>
  <div class="note">
    · 참석 체크박스는 기본적으로 모두 꺼진 상태입니다. 오는 사람만 체크하세요.<br>
    · 포지션은 직접 수정하거나, 입력 중에 리스트에서 골라 쓸 수 있습니다.<br>
    · 목표 쿼터는 0.5 단위 입력 가능 (예: 2.5), 지각/조퇴는 시작Q/종료Q로 조정.
  </div>

  <!-- 결과 영역 -->
  <h2>쿼터별 라인업 결과</h2>
  <div id="summary" class="note"></div>
  <div class="q-wrapper" id="quartersContainer">
    <!-- JS에서 각 쿼터 카드 생성 -->
  </div>

<script>
/* =========================
   1. 메타데이터 (선수 & 포지션 & 포메이션)
   ========================= */

// 초기 선수 리스트 (최초 1번만 사용, 이후에는 localStorage에서 로딩)
const initialPlayersTemplate = [
  { name: "상준",  main: "LW", sub1: "RW", sub2: "AM" },
  { name: "태호",  main: "LW", sub1: "RW", sub2: ""  },
  { name: "영철",  main: "CB", sub1: "CM", sub2: ""  },
  { name: "규민",  main: "RB", sub1: "RW", sub2: "LB" },
  { name: "승현",  main: "CM", sub1: "AM", sub2: "DM" },
  { name: "김재현", main: "DM", sub1: "CM", sub2: "CB" },
  { name: "봉준",  main: "DM", sub1: "CM", sub2: "CB" },
  { name: "희환",  main: "CB", sub1: "RB", sub2: "LB" },
  { name: "성일",  main: "CB", sub1: "RB", sub2: "LB" },
  { name: "이재현",main: "GK", sub1: "LB", sub2: "RB" },
  { name: "연수",  main: "LB", sub1: "RB", sub2: "CM" },
  { name: "시원",  main: "CB", sub1: "RB", sub2: "DM" },
  { name: "지환",  main: "GK", sub1: "",   sub2: ""   },
  { name: "성영",  main: "LB", sub1: "RB", sub2: "RW" },
  { name: "종규",  main: "AM", sub1: "CM", sub2: "LW" },
  { name: "영현",  main: "RB", sub1: "LB", sub2: "RW" },
  { name: "명렬",  main: "DM", sub1: "CM", sub2: "CB" },
  { name: "성원",  main: "CF", sub1: "CM", sub2: "RW" },
  { name: "수형",  main: "RW", sub1: "AM", sub2: "LW" },
  { name: "시훈",  main: "CF", sub1: "AM", sub2: "CB" },
  { name: "광경",  main: "LW", sub1: "RW", sub2: "RB" },
  { name: "용락",  main: "CM", sub1: "DM", sub2: "CB" },
  { name: "현일",  main: "CF", sub1: "CB", sub2: ""   },
  { name: "호균",  main: "DM", sub1: "CM", sub2: "AM" }
];

// localStorage key
const STORAGE_KEY = "restartfc_players_v2";

/**
 * 포메이션 정의 (인원수 + 백 기준)
 * 키: '4-back_11', '3-back_11', '4-back_10', '3-back_10'
 */
const FORMATIONS = {
  // 11명용 4백: 4-3-3
  "4-back_11": {
    label: "4-3-3",
    grid: [
      [ null, "CF",  null ],
      [ "LW", null,  "RW" ],
      [ "LCM","DM", "RCM"],
      [ "LB", "LCB","RCB","RB" ],
      [ null, "GK", null ]
    ]
  },
  // 11명용 3백: 3-4-3
  "3-back_11": {
    label: "3-4-3",
    grid: [
      [ null, "CF",  null ],
      [ "LW", null,  "RW" ],
      [ "LM", "LCM","RCM","RM" ],
      [ null, "LCB","CB","RCB" ],
      [ null, "GK", null ]
    ]
  },
  // 10명용 4백: 4-2-3
  "4-back_10": {
    label: "4-2-3",
    grid: [
      [ null, "CF",  null ],
      [ "LW", null,  "RW" ],
      [ "DM", "CM", null ],
      [ "LB", "LCB","RCB","RB" ],
      [ null, "GK", null ]
    ]
  },
  // 10명용 3백: 3-5-1
  "3-back_10": {
    label: "3-5-1",
    grid: [
      [ null, "CF",  null ],
      [ "LM", "LCM","RCM","RM" ],
      [ null, "DM",  null ],
      [ null, "LCB","CB","RCB" ],
      [ null, "GK", null ]
    ]
  }
};

// 포지션 우선순위 (명단 정렬용)
// 요구: GK - CF - LB - RB - DM - CM - AM - LW - RW - CF (+나머지)
// CF는 중복이므로 한 번만 두고, 기타 CB 계열/사이드MF 등은 뒤로 배치
const POSITION_PRIORITY = [
  "GK",
  "CF",
  "LB",
  "RB",
  "DM",
  "CM",
  "AM",
  "LW",
  "RW",
  "LCB",
  "RCB",
  "CB",
  "LCM",
  "RCM",
  "LM",
  "RM"
];

// 유틸: 포메이션의 포지션 목록 (중복 없이)
function flattenPositions(grid) {
  const list = [];
  grid.forEach(row => {
    row.forEach(p => {
      if (p && !list.includes(p)) list.push(p);
    });
  });
  return list;
}

// playersPerSide(10/11) + "4-back"/"3-back" → FORMATIONS 키
function resolveFormationKey(playersPerSide, baseType) {
  return `${baseType}_${playersPerSide}`;
}

// 포지션 순서 점수
function getPositionRank(pos) {
  const idx = POSITION_PRIORITY.indexOf(pos);
  return idx === -1 ? 999 : idx;
}

/* =========================
   2. 선수 데이터 로딩 / 저장
   ========================= */

let players = []; // 이번 경기 설정이 적용된 플레이어 배열

function loadPlayersFromStorage() {
  try {
    const raw = window.localStorage.getItem(STORAGE_KEY);
    if (!raw) return null;
    const parsed = JSON.parse(raw);
    if (!Array.isArray(parsed)) return null;
    return parsed;
  } catch (e) {
    console.warn("loadPlayers error", e);
    return null;
  }
}

function savePlayersToStorage() {
  try {
    const toSave = players.map(p => ({
      name: p.name,
      main: p.main,
      sub1: p.sub1,
      sub2: p.sub2,
      present: p.present,
      targetQ: p.targetQ,
      startQ: p.startQ,
      endQ: p.endQ
    }));
    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(toSave));
  } catch (e) {
    console.warn("savePlayers error", e);
  }
}

/* =========================
   3. 화면 초기 렌더링
   ========================= */

function init() {
  const stored = loadPlayersFromStorage();
  const base = stored && stored.length > 0 ? stored : initialPlayersTemplate;

  players = base.map(p => ({
    name: p.name || "",
    main: (p.main || "").toUpperCase(),
    sub1: (p.sub1 || "").toUpperCase(),
    sub2: (p.sub2 || "").toUpperCase(),
    // 참석여부 기본 false
    present: p.present !== undefined ? !!p.present : false,
    targetQ: p.targetQ !== undefined ? Number(p.targetQ) || 3 : 3,
    startQ: p.startQ !== undefined ? Number(p.startQ) || 1 : 1,
    endQ: p.endQ !== undefined ? Number(p.endQ) || 4 : 4,
    allocatedSlots: 0
  }));

  renderPlayersTable();
  renderQuarterCards();
}

function renderPlayersTable() {
  const tbody = document.querySelector("#playersTable tbody");
  tbody.innerHTML = "";

  // 주포지션 기준으로 정렬 (GK → CF → LB → RB → …)
  const sorted = [...players].sort((a, b) => {
    const ra = getPositionRank(a.main);
    const rb = getPositionRank(b.main);
    if (ra !== rb) return ra - rb;
    // 같은 포지션이면 이름 순
    return (a.name || "").localeCompare(b.name || "", "ko");
  });

  sorted.forEach((p) => {
    const idxInOriginal = players.indexOf(p);
    const tr = document.createElement("tr");

    // 참석 체크박스
    const tdPresent = document.createElement("td");
    const chk = document.createElement("input");
    chk.type = "checkbox";
    chk.checked = p.present;
    chk.onchange = () => {
      p.present = chk.checked;
      savePlayersToStorage();
    };
    tdPresent.appendChild(chk);
    tr.appendChild(tdPresent);

    // 이름
    const tdName = document.createElement("td");
    const inputName = document.createElement("input");
    inputName.type = "text";
    inputName.value = p.name;
    inputName.style.width = "80px";
    inputName.oninput = () => {
      p.name = inputName.value.trim();
      savePlayersToStorage();
    };
    tdName.appendChild(inputName);
    tr.appendChild(tdName);

    // 포지션들 (텍스트 + datalist)
    ["main","sub1","sub2"].forEach(key => {
      const td = document.createElement("td");
      const inputPos = document.createElement("input");
      inputPos.type = "text";
      inputPos.setAttribute("list", "positionList");
      inputPos.value = p[key] || "";
      inputPos.style.width = "60px";
      inputPos.oninput = () => {
        p[key] = inputPos.value.trim().toUpperCase();
        savePlayersToStorage();
        renderPlayersTable(); // 포지션 바꾸면 정렬 다시
      };
      td.appendChild(inputPos);
      tr.appendChild(td);
    });

    // 목표 쿼터
    const tdTarget = document.createElement("td");
    const inputTarget = document.createElement("input");
    inputTarget.type = "number";
    inputTarget.step = "0.5";
    inputTarget.min = "0";
    inputTarget.value = p.targetQ;
    inputTarget.style.width = "50px";
    inputTarget.onchange = () => {
      p.targetQ = Number(inputTarget.value) || 0;
      savePlayersToStorage();
    };
    tdTarget.appendChild(inputTarget);
    tr.appendChild(tdTarget);

    // 시작Q
    const tdStart = document.createElement("td");
    const inputStart = document.createElement("input");
    inputStart.type = "number";
    inputStart.min = "1";
    inputStart.max = "4";
    inputStart.value = p.startQ;
    inputStart.style.width = "40px";
    inputStart.onchange = () => {
      p.startQ = Number(inputStart.value) || 1;
      savePlayersToStorage();
    };
    tdStart.appendChild(inputStart);
    tr.appendChild(tdStart);

    // 종료Q
    const tdEnd = document.createElement("td");
    const inputEnd = document.createElement("input");
    inputEnd.type = "number";
    inputEnd.min = "1";
    inputEnd.max = "4";
    inputEnd.value = p.endQ;
    inputEnd.style.width = "40px";
    inputEnd.onchange = () => {
      p.endQ = Number(inputEnd.value) || 4;
      savePlayersToStorage();
    };
    tdEnd.appendChild(inputEnd);
    tr.appendChild(tdEnd);

    // 삭제 버튼
    const tdDel = document.createElement("td");
    const btnDel = document.createElement("button");
    btnDel.className = "icon-btn";
    btnDel.innerHTML = "✕";
    btnDel.title = "선수 삭제";
    btnDel.onclick = () => {
      if (confirm(`${p.name || "이 선수"}를 삭제할까요?`)) {
        const realIdx = players.indexOf(p);
        if (realIdx >= 0) {
          players.splice(realIdx, 1);
          savePlayersToStorage();
          renderPlayersTable();
        }
      }
    };
    tdDel.appendChild(btnDel);
    tr.appendChild(tdDel);

    tbody.appendChild(tr);
  });
}

function renderQuarterCards() {
  const container = document.getElementById("quartersContainer");
  container.innerHTML = "";
  for (let q=1;q<=4;q++) {
    const card = document.createElement("div");
    card.className = "q-card";
    card.id = `cardQ${q}`;
    const h3 = document.createElement("h3");
    h3.innerHTML = `${q}Q <span class="badge" id="badgeQ${q}"></span>`;
    card.appendChild(h3);

    const table = document.createElement("table");
    table.innerHTML = `
      <thead>
        <tr><th>포지션</th><th>전반(A)</th><th>후반(B)</th></tr>
      </thead>
      <tbody id="tbodyQ${q}"></tbody>
    `;
    card.appendChild(table);

    const pitch = document.createElement("div");
    pitch.id = `pitchQ${q}`;
    pitch.className = "pitch";
    card.appendChild(pitch);

    container.appendChild(card);
  }
}

/* =========================
   4. 선수 추가 / 초기화
   ========================= */

function addPlayer() {
  players.push({
    name: "",
    main: "",
    sub1: "",
    sub2: "",
    present: false, // 새 선수도 기본은 참석 X
    targetQ: 2,
    startQ: 1,
    endQ: 4,
    allocatedSlots: 0
  });
  savePlayersToStorage();
  renderPlayersTable();
}

function resetPlayers() {
  if (!confirm("선수 목록을 처음 상태로 되돌릴까요? (현재 저장된 정보는 사라집니다)")) return;
  window.localStorage.removeItem(STORAGE_KEY);
  init();
}

/* =========================
   5. 라인업 생성 로직
   ========================= */

function generateLineup() {
  const playersPerSide = Number(document.getElementById("playersPerSide").value);
  const baseFormationByQuarter = {
    1: document.getElementById("fQ1").value, // "4-back" or "3-back"
    2: document.getElementById("fQ2").value,
    3: document.getElementById("fQ3").value,
    4: document.getElementById("fQ4").value
  };

  const formationKeyByQuarter = {};
  for (let q=1;q<=4;q++) {
    formationKeyByQuarter[q] = resolveFormationKey(playersPerSide, baseFormationByQuarter[q]);
  }

  // 선수별 상태 초기화
  players.forEach(p => {
    p.allocatedSlots = 0;
  });

  // 슬롯 목록 생성 (쿼터 × 포지션 × 전/후반)
  const slots = [];
  for (let q=1;q<=4;q++) {
    const formKey = formationKeyByQuarter[q];
    const form = FORMATIONS[formKey];
    if (!form) continue;
    const positions = flattenPositions(form.grid); // 인원수에 맞게 설계됨

    ["A","B"].forEach(half => {
      positions.forEach((pos, posIndex) => {
        slots.push({ quarter:q, half, position:pos, posIndex, playerIndex:null });
      });
    });
  }

  // Greedy 배분
  slots.forEach(slot => {
    let bestIdx = -1;
    let bestScore = -1e15;

    players.forEach((p, idx) => {
      const score = scorePlayerForSlot(p, slot);
      if (score > bestScore) {
        bestScore = score;
        bestIdx = idx;
      }
    });

    if (bestIdx >= 0 && bestScore > -1e10) {
      slot.playerIndex = bestIdx;
      players[bestIdx].allocatedSlots += 1; // 0.5쿼터
    }
  });

  renderResult(slots, formationKeyByQuarter);
}

function scorePlayerForSlot(p, slot) {
  if (!p.present) return -1e12;
  if (!p.name) return -1e12;

  // 쿼터 범위 체크
  if (slot.quarter < p.startQ || slot.quarter > p.endQ) return -1e12;

  const targetSlots = (p.targetQ || 0) * 2;
  if (targetSlots <= 0) return -1e12;

  // 이미 목표 슬롯 다 채웠으면 우선순위 낮춤
  if (p.allocatedSlots >= targetSlots) return -1e9;

  let score = 0;

  if (slot.position === p.main)      score += 100;
  else if (slot.position === p.sub1) score += 70;
  else if (slot.position === p.sub2) score += 50;
  else                               score += 5;   // 포지션 안맞지만 사람이 없을때용

  // 덜 뛴 사람에게 가산점
  const remain = targetSlots - p.allocatedSlots;
  score += remain;

  return score;
}

/* =========================
   6. 결과 테이블 & 포메이션 그라운드 렌더링
   ========================= */

function renderResult(slots, formationKeyByQuarter) {
  // 쿼터/포지션별 A/B 이름 집계
  const result = {}; // { q: { pos: {A:name, B:name} } }

  for (let q=1;q<=4;q++) {
    result[q] = {};
  }

  slots.forEach(slot => {
    const q = slot.quarter;
    const pos = slot.position;
    const playerName = slot.playerIndex != null ? players[slot.playerIndex].name : "";
    if (!result[q][pos]) result[q][pos] = {A:"",B:""};
    result[q][pos][slot.half] = playerName;
  });

  // 쿼터별 테이블 & 그라운드 채우기
  for (let q=1;q<=4;q++) {
    const formKey = formationKeyByQuarter[q];
    const form = FORMATIONS[formKey];
    const tbody = document.getElementById(`tbodyQ${q}`);
    const badge = document.getElementById(`badgeQ${q}`);
    const pitch = document.getElementById(`pitchQ${q}`);

    if (!form) {
      if (tbody) tbody.innerHTML = "";
      if (badge) badge.textContent = "";
      if (pitch) pitch.innerHTML = "";
      continue;
    }

    const positions = flattenPositions(form.grid);
    tbody.innerHTML = "";

    positions.forEach(pos => {
      const rowData = result[q][pos] || {A:"",B:""};
      let displayA = rowData.A || "";
      let displayB = rowData.B || "";

      // 전반/후반이 동일하면 한 번만 표시
      if (displayA && displayA === displayB) {
        displayB = "";
      }

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${pos}</td>
        <td>${displayA || "-"}</td>
        <td>${displayB || "-"}</td>
      `;
      tbody.appendChild(tr);
    });

    badge.textContent = form.label;

    // 미니 그라운드 렌더링 (A 기준, 없으면 B)
    if (pitch) {
      pitch.innerHTML = "";
      form.grid.forEach(row => {
        const rowDiv = document.createElement("div");
        rowDiv.className = "pitch-row";
        row.forEach(pos => {
          const cell = document.createElement("div");
          cell.className = "pitch-cell";
          if (pos) {
            const data = result[q][pos] || {A:"",B:""};
            const name = data.A || data.B || "";
            const posDiv = document.createElement("div");
            posDiv.className = "pitch-pos";
            posDiv.textContent = pos;
            const nameDiv = document.createElement("div");
            nameDiv.className = "pitch-name";
            nameDiv.textContent = name || "-";
            cell.appendChild(posDiv);
            cell.appendChild(nameDiv);
          }
          rowDiv.appendChild(cell);
        });
        pitch.appendChild(rowDiv);
      });
    }
  }

  // 전체 요약: 총 슬롯 vs 목표 슬롯
  let totalTargetSlots = 0;
  let totalAllocatedSlots = 0;
  players.forEach(p => {
    if (!p.present || !p.name) return;
    const t = (p.targetQ || 0) * 2;
    totalTargetSlots += t;
    totalAllocatedSlots += p.allocatedSlots;
  });

  const summary = document.getElementById("summary");
  const diff = totalAllocatedSlots - totalTargetSlots; // +면 더 많이 배정됨
  summary.innerHTML =
    `총 슬롯: ${totalAllocatedSlots/2}쿼터 인분 / 목표: ${totalTargetSlots/2}쿼터 인분 `
    + `(차이: ${diff/2}쿼터)`;
}

/* =========================
   7. 초기 실행
   ========================= */
init();
</script>
</body>
</html>
